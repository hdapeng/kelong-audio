file: d:\code demo\kelong-audio-main\需求文档.md
# 产品需求文档（PRD）——语音生成应用

## 1. 产品概述
- 名称：语音生成（Text-to-Speech，含提示音色克隆）
- 简述：基于 Gitee AI TTS API 的 Web 应用。用户输入文本与提示音频 URL，生成目标语音；支持可选提示文本辅助音色克隆。
- 当前实现参考：
  - 初始化与UI绑定：`index.html:96-150`
  - 请求体构造与发送：`index.html:247-292`
  - 响应处理与播放器：`index.html:317-346`
  - 错误提示与状态反馈：`index.html:313-315`, `index.html:395-398`

## 2. 背景与目标
- 背景：需求快速验证 TTS 能力，同时提供通过 URL 的提示音频进行音色克隆的体验。
- 目标：
  - MVP：在浏览器内完成文本到语音的生成与播放。
  - 提升：完善错误处理、可观测性、权限安全与可维护性。

## 3. 用户与场景
- 用户画像：内容创作者、产品原型验证者、开发测试人员。
- 核心场景：
  - 文案快速配音
  - 指定音色克隆（通过提示音频 URL）
  - 轻量验证 API 效果

## 4. 范围与不在范围
- 在范围（MVP）
  - 文本输入、提示音频 URL、可选提示文本
  - API 调用与音频播放
  - 本地存储最近使用的提示音频 URL
- 不在范围（当前阶段）
  - 本地文件上传
  - 多模型/多音色动态选择
  - 后端代理与账号体系

## 5. 核心流程
- 基本流程：
  1) 用户输入文本与提示音频 URL（可选提示文本）
  2) 点击“生成语音”
  3) 前端构造请求体并调用 Gitee AI TTS
  4) 返回音频 Blob，创建 URL，播放器播音
- 现有实现：
  - 请求体字段：`input`, `model`, `voice`, `prompt_audio_url`，可选 `prompt_text`（`index.html:247-258`）
  - 生成过程状态与计时：按钮内状态与秒数提示（`index.html:237-246`, `index.html:347-351`）

## 6. 功能需求
- 文本输入
  - 必填；长度无硬限制但提示超过2000字符可能变慢（`index.html:212-215`）
  - 实时字符数展示（`index.html:165-185`）
- 提示音频 URL
  - 必填；必须可公开访问；推荐 `.wav` 格式（UI说明：`index.html:54-57`）
  - 最近一次 URL 持久化于 `localStorage`（`index.html:187-195`, `index.html:217-227`）
- 提示文本（可选）
  - 存在时加入请求体（`index.html:255-258`）
- 生成与播放
  - 点击生成后展示加载状态与等待时长（`index.html:238-246`, `index.html:381-393`）
  - 响应成功后展示播放器与用时（`index.html:338-346`）
- 错误与状态
  - 字段校验错误提示（`index.html:206-210`, `index.html:395-398`）
  - 常见错误映射：网络/CORS、401/404/429（`index.html:355-367`）
- 历史音频与清理
  - 生成的 Blob URL 存储及24小时过期清理（`index.html:401-433`）
  - 过期策略：`AUDIO_EXPIRY_TIME = 24h`（`index.html:103`）

## 7. 接口与数据
- API
  - Endpoint：`https://ai.gitee.com/v1/audio/speech`（`index.html:99`）
  - Auth：`Authorization: Bearer <API_KEY>`（`index.html:276-278`, `index.html:287-290`）
  - Request（JSON）：
    - `input`: string（文本）
    - `model`: string（当前硬编码 `IndexTTS-2`，`index.html:250`）
    - `voice`: string（当前硬编码 `alloy`，`index.html:251`）
    - `prompt_audio_url`: string（公开 URL）
    - `prompt_text`: string（可选）
  - Response：音频二进制（Blob），MIME 应为 `audio/*`（校验：`index.html:325-335`）
- 本地存储键
  - `gitee_tts_last_prompt_url`
  - `gitee_tts_audio_urls`（含时间戳）

## 8. 非功能需求
- 安全
  - 禁止在前端硬编码真实 `API_KEY`（现状风险：`index.html:98`）；需后端代理或安全注入
- 性能
  - 文本长时提示与渐进式反馈；生成时UI不可重复提交
- 可靠性
  - 明确错误信息与重试提示；容错于非音频响应
- 可用性与无障碍
  - 清晰的字段说明与错误文案；键盘操作与屏幕阅读兼容
- 可维护性
  - 配置隔离、日志开关、常量集中管理

## 9. 交互与UI规范
- 表单布局、状态按钮、错误提示区域与播放器位置如当前实现（`index.html:29-94`）
- 按钮内展示加载动画与等待秒数（`index.html:237-246`）
- 成功后展示“生成用时”与音频控件（`index.html:338-346`）

## 10. 指标与埋点（建议）
- 生成请求数、成功率、平均生成时长
- 失败类型分布（网络/CORS/401/429等）
- 文本长度分布、提示 URL 使用率
- 播放完成率与复播次数

## 11. 风险与对策
- API Key 暴露：改为后端代理签发或服务端注入（移除`index.html:98`）
- CORS 限制：使用同源后端代理或预检配置；错误文案引导（`index.html:358-360`）
- 非音频响应：增强类型检查与错误说明（`index.html:325-335`）
- 资源泄露：定期清理 Blob URL 与缓存（`index.html:419-433`）

## 12. 里程碑
- M0（当前）：前端直连 MVP 完成，播放闭环
- M1：后端代理与安全配置、错误与指标完善
- M2：模型/音色可选、上传能力、项目化配置与文档化

## 13. 验收标准
- 必填项校验与错误提示正确
- 成功返回为可播放音频；展示用时与播放器
- 本地存储与过期清理机制工作正常
- 常见错误类型具备明确用户反馈